<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RetailAI - Smart Demo</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        .phone-screen { scrollbar-width: none; -ms-overflow-style: none; }
        .phone-screen::-webkit-scrollbar { display: none; }
        .typing-dot { animation: typing 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        
        /* Pulse animation for recording */
        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 0.5; }
            100% { transform: scale(2); opacity: 0; }
        }
        .recording-ring::before {
            content: ''; position: absolute; left: 0; top: 0; width: 100%; height: 100%;
            background-color: #ef4444; border-radius: 50%; z-index: -1; animation: pulse-ring 1.5s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const Icon = ({ name, className }) => <i className={`ph-fill ph-${name} ${className}`}></i>;

        function App() {
            // --- STATE ---
            const [messages, setMessages] = useState([
                { id: 1, sender: 'bot', text: "Karibu! üëã I'm the Nairobi Fashion AI. You can type or send a Voice Note üéôÔ∏è to order." }
            ]);
            const [inputText, setInputText] = useState("");
            const [isTyping, setIsTyping] = useState(false);
            const [activeNode, setActiveNode] = useState(null); 
            const [isRecording, setIsRecording] = useState(false);
            
            // Business Data
            const [revenue, setRevenue] = useState(14500);
            const [inventory, setInventory] = useState({ "Red Dress": 4, "Blue Denim": 12, "Sneakers": 8 });

            const bottomRef = useRef(null);

            useEffect(() => { bottomRef.current?.scrollIntoView({ behavior: "smooth" }); }, [messages, isTyping]);

            // --- LOGIC HANDLERS ---
            
            // 1. Handle Voice Note (Simulated)
            const handleVoiceRecord = async () => {
                if (isRecording) return;
                setIsRecording(true);
                
                // Simulate recording time
                setTimeout(() => {
                    setIsRecording(false);
                    const voiceMsg = { 
                        id: Date.now(), 
                        sender: 'user', 
                        type: 'audio', 
                        duration: '0:04' 
                    };
                    setMessages(prev => [...prev, voiceMsg]);
                    setIsTyping(true);
                    
                    // Pass "transcribed" text to logic
                    processLogic("I want that red dress please");
                }, 2000);
            };

            // 2. Handle Text
            const handleSend = () => {
                if (!inputText.trim()) return;
                const userMsg = { id: Date.now(), sender: 'user', text: inputText };
                setMessages(prev => [...prev, userMsg]);
                setInputText("");
                setIsTyping(true);
                processLogic(userMsg.text);
            };

            // 3. The AI Brain
            const processLogic = async (text) => {
                const lowerText = text.toLowerCase();
                
                // TRIGGER: Whisper API (if it was voice)
                if (text === "I want that red dress please") {
                    setActiveNode("whisper"); 
                    await wait(800);
                }

                // TRIGGER: OpenAI Intent
                setActiveNode("openai");
                await wait(1000);

                // SCENARIO A: Inventory Check
                if (lowerText.includes("dress") || lowerText.includes("red")) {
                    setActiveNode("loyverse");
                    await wait(1000);
                    
                    if (inventory["Red Dress"] > 0) {
                        setIsTyping(false);
                        addBotMessage(`I found it! We have ${inventory["Red Dress"]} Red Dresses left (Size M). Price: KES 2,500.`);
                        
                        // UPSELL LOGIC (Smart AI)
                        await wait(1000);
                        setIsTyping(true);
                        await wait(1000);
                        setIsTyping(false);
                        addBotMessage("üí° Style Tip: These White Sneakers go perfectly with the red dress. Want to add them for KES 1,500?");
                    }
                    setActiveNode(null);
                    return;
                }

                // SCENARIO B: Yes/Buy (Handling the Upsell or Direct Buy)
                if (lowerText.includes("yes") || lowerText.includes("both") || lowerText.includes("buy")) {
                    setIsTyping(false);
                    const total = lowerText.includes("both") ? 4000 : 2500;
                    
                    setActiveNode("paystack");
                    addBotMessage(`Perfect! Total is KES ${total.toLocaleString()}. Triggering M-Pesa prompt now...`);
                    
                    // Show Payment Card
                    setTimeout(() => {
                        setMessages(prev => [...prev, { 
                            id: Date.now(), 
                            sender: 'system', 
                            type: 'payment_card',
                            amount: total
                        }]);
                    }, 600);
                    return;
                }

                // DEFAULT RESPONSE
                setIsTyping(false);
                addBotMessage("I can help you check stock. Try sending a voice note saying 'Do you have a Red Dress?'");
                setActiveNode(null);
            };

            const handlePaymentConfirm = async (amount) => {
                setActiveNode("paystack_loop");
                await wait(2000);
                
                setRevenue(prev => prev + amount);
                setInventory(prev => ({...prev, "Red Dress": prev["Red Dress"] - 1}));
                
                // Show Map
                setActiveNode("uber");
                await wait(1000);
                addBotMessage("‚úÖ Payment Received! Dispatching rider...");
                await wait(800);
                setMessages(prev => [...prev, { id: Date.now(), sender: 'system', type: 'map' }]);
                
                setActiveNode("airtable");
                setTimeout(() => setActiveNode(null), 2000);
            };

            const addBotMessage = (text) => setMessages(prev => [...prev, { id: Date.now(), sender: 'bot', text }]);
            const wait = (ms) => new Promise(resolve => setTimeout(resolve, ms));

            return (
                <div className="min-h-screen flex flex-col lg:flex-row max-w-7xl mx-auto p-4 gap-6">
                    
                    {/* LEFT: DASHBOARD (Business View) */}
                    <div className="w-full lg:w-1/3 space-y-4">
                        <div className="bg-white p-5 rounded-2xl shadow-sm border border-slate-200">
                            <div className="flex justify-between items-center mb-4">
                                <h2 className="font-bold text-slate-800 flex items-center gap-2">
                                    <Icon name="chart-bar" className="text-blue-600" /> Business Overview
                                </h2>
                                <span className="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full">‚óè Live</span>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div className="bg-blue-50 p-4 rounded-xl">
                                    <div className="text-slate-500 text-xs mb-1">Total Sales</div>
                                    <div className="text-2xl font-bold text-slate-800">KES {revenue.toLocaleString()}</div>
                                </div>
                                <div className="bg-orange-50 p-4 rounded-xl">
                                    <div className="text-slate-500 text-xs mb-1">Orders</div>
                                    <div className="text-2xl font-bold text-slate-800">14</div>
                                </div>
                            </div>
                        </div>

                        {/* Logic Visualizer */}
                        <div className="bg-white p-5 rounded-2xl shadow-sm border border-slate-200">
                            <h3 className="font-bold text-slate-700 mb-4 text-sm">Automation Engine (Make.com)</h3>
                            <div className="space-y-3">
                                <LogicItem id="whisper" active={activeNode} icon="microphone" label="Whisper (Audio-to-Text)" color="text-purple-600" bg="bg-purple-50" />
                                <LogicItem id="openai" active={activeNode} icon="brain" label="GPT-4o Intent" color="text-green-600" bg="bg-green-50" />
                                <LogicItem id="loyverse" active={activeNode} icon="storefront" label="Loyverse Stock" color="text-orange-600" bg="bg-orange-50" />
                                <LogicItem id="paystack" active={activeNode} icon="credit-card" label="Paystack STK" color="text-blue-600" bg="bg-blue-50" />
                                <LogicItem id="uber" active={activeNode} icon="moped" label="Uber Direct" color="text-slate-800" bg="bg-slate-100" />
                            </div>
                        </div>
                        
                        <div className="bg-slate-800 text-slate-400 p-4 rounded-xl text-xs font-mono">
                            <p className="mb-2 text-slate-200 font-bold border-b border-slate-700 pb-1">Real-time Logs</p>
                            {activeNode === 'whisper' && <p className="text-purple-400">> Transcribing audio file...</p>}
                            {activeNode === 'openai' && <p className="text-green-400">> Identifying upsell opportunity...</p>}
                            {activeNode === 'paystack_loop' && <p className="text-blue-400">> Waiting for M-Pesa PIN...</p>}
                            {activeNode === 'uber' && <p className="text-white">> Finding nearest rider (2km away)...</p>}
                            {!activeNode && <p>System Idle. Listening for webhooks...</p>}
                        </div>
                    </div>

                    {/* CENTER: PHONE SIMULATOR */}
                    <div className="w-full lg:w-1/3 flex justify-center">
                        <div className="w-[360px] h-[720px] bg-slate-900 rounded-[3rem] border-[8px] border-slate-900 shadow-2xl overflow-hidden relative flex flex-col">
                            {/* Header */}
                            <div className="bg-[#075E54] text-white p-4 pt-12 flex items-center gap-3 shadow-md z-10">
                                <div className="w-9 h-9 bg-white/20 rounded-full flex items-center justify-center">
                                    <Icon name="robot" className="text-lg" />
                                </div>
                                <div>
                                    <h3 className="font-semibold text-sm">Fashion Hub Bot</h3>
                                    <p className="text-[10px] opacity-80">Replies instantly</p>
                                </div>
                                <div className="ml-auto flex gap-3">
                                    <Icon name="video-camera" />
                                    <Icon name="phone" />
                                </div>
                            </div>

                            {/* Chat Body */}
                            <div className="bg-[#efeae2] flex-1 overflow-y-auto phone-screen p-4 space-y-3 bg-opacity-90" style={{backgroundImage: 'url("https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png")', backgroundBlendMode: 'overlay'}}>
                                {messages.map(msg => (
                                    <div key={msg.id} className={`flex flex-col ${msg.sender === 'user' ? 'items-end' : 'items-start'}`}>
                                        {msg.type === 'audio' ? (
                                            <div className="bg-[#DCF8C6] p-2 rounded-lg rounded-tr-none shadow-sm w-48 flex items-center gap-3">
                                                <div className="w-8 h-8 bg-green-600 rounded-full flex items-center justify-center text-white">
                                                    <Icon name="play" className="text-xs" />
                                                </div>
                                                <div className="flex-1">
                                                    <div className="h-1 bg-green-600/30 rounded-full w-full mb-1">
                                                        <div className="h-1 bg-green-600 rounded-full w-2/3"></div>
                                                    </div>
                                                    <div className="text-[10px] text-slate-500">{msg.duration} ‚Ä¢ 12:42 PM</div>
                                                </div>
                                                <div className="w-6 h-6 rounded-full overflow-hidden border border-white">
                                                   <img src="https://i.pravatar.cc/100?img=33" alt="User" />
                                                </div>
                                            </div>
                                        ) : msg.type === 'payment_card' ? (
                                            <div className="bg-white p-3 rounded-lg shadow-sm w-56 border-l-4 border-green-500">
                                                <div className="flex justify-between items-start mb-2">
                                                    <div className="text-sm font-bold text-slate-800">M-Pesa Express</div>
                                                    <div className="bg-green-100 text-green-800 text-[10px] px-1 rounded">SECURE</div>
                                                </div>
                                                <p className="text-xs text-slate-500 mb-3">Amount: <span className="text-slate-800 font-bold">KES {msg.amount.toLocaleString()}</span></p>
                                                <button onClick={() => handlePaymentConfirm(msg.amount)} className="w-full bg-green-500 hover:bg-green-600 text-white text-xs py-2 rounded font-medium transition">
                                                    Tap to Pay
                                                </button>
                                            </div>
                                        ) : msg.type === 'map' ? (
                                            <div className="bg-white p-0 rounded-lg shadow-sm w-60 overflow-hidden">
                                                <div className="h-24 bg-blue-50 relative">
                                                    <div className="absolute inset-0 opacity-30" style={{backgroundImage: 'radial-gradient(#cbd5e1 1px, transparent 1px)', backgroundSize: '10px 10px'}}></div>
                                                    {/* Simple CSS Map Path */}
                                                    <svg className="absolute inset-0 w-full h-full" viewBox="0 0 100 50">
                                                        <path d="M 10 25 Q 50 10 90 25" stroke="#3b82f6" strokeWidth="2" fill="none" strokeDasharray="4" />
                                                        <circle cx="90" cy="25" r="3" fill="#ef4444" className="animate-ping" />
                                                        <circle cx="90" cy="25" r="3" fill="#ef4444" />
                                                    </svg>
                                                </div>
                                                <div className="p-3">
                                                    <div className="flex items-center gap-2 mb-1">
                                                        <div className="w-8 h-8 bg-slate-100 rounded-full flex items-center justify-center">
                                                            <Icon name="moped" className="text-slate-600" />
                                                        </div>
                                                        <div>
                                                            <div className="text-xs font-bold">Rider: Juma</div>
                                                            <div className="text-[10px] text-green-600">Arriving in 12 mins</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        ) : (
                                            <div className={`max-w-[85%] p-2 px-3 rounded-lg text-sm shadow-sm ${msg.sender === 'user' ? 'bg-[#DCF8C6] text-slate-900 rounded-tr-none' : 'bg-white text-slate-900 rounded-tl-none'}`}>
                                                {msg.text}
                                                <div className="text-[9px] text-right opacity-40 mt-1">12:42 PM</div>
                                            </div>
                                        )}
                                    </div>
                                ))}
                                {isTyping && <div className="bg-white p-2 rounded-lg rounded-tl-none self-start w-12 flex items-center justify-center gap-1 shadow-sm"><div className="w-1 h-1 bg-slate-400 rounded-full typing-dot"></div><div className="w-1 h-1 bg-slate-400 rounded-full typing-dot"></div><div className="w-1 h-1 bg-slate-400 rounded-full typing-dot"></div></div>}
                                <div ref={bottomRef}></div>
                            </div>

                            {/* Input Area */}
                            <div className="bg-[#f0f2f5] p-2 px-3 flex items-center gap-2">
                                <button className="text-slate-500"><Icon name="plus" className="text-xl" /></button>
                                <input 
                                    type="text" 
                                    className="flex-1 bg-white rounded-full px-4 py-2 text-sm focus:outline-none"
                                    placeholder="Message..."
                                    value={inputText}
                                    onChange={(e) => setInputText(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && handleSend()}
                                />
                                {inputText ? (
                                    <button onClick={handleSend} className="bg-[#075E54] text-white w-10 h-10 rounded-full flex items-center justify-center shadow hover:scale-105 transition">
                                        <Icon name="paper-plane-right" className="text-lg" />
                                    </button>
                                ) : (
                                    <button 
                                        onClick={handleVoiceRecord}
                                        className={`w-10 h-10 rounded-full flex items-center justify-center shadow transition relative ${isRecording ? 'bg-red-500 text-white recording-ring' : 'bg-[#075E54] text-white hover:scale-105'}`}
                                    >
                                        <Icon name={isRecording ? "stop" : "microphone"} className="text-lg" />
                                    </button>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* RIGHT: INFO PANEL */}
                    <div className="w-full lg:w-1/3 bg-white p-6 rounded-2xl shadow-sm border border-slate-200 h-fit">
                        <h2 className="font-bold text-slate-800 mb-4">Why this works in Kenya üá∞üá™</h2>
                        <ul className="space-y-4">
                            <FeaturePoint icon="microphone" color="text-purple-600" title="Voice-First Commerce" desc="70% of WhatsApp users prefer voice notes. We automate them using Whisper API." />
                            <FeaturePoint icon="trend-up" color="text-green-600" title="AI Upselling" desc="The bot knows that 'Red Dress' goes with 'White Sneakers' and suggests it automatically." />
                            <FeaturePoint icon="map-pin" color="text-blue-600" title="Trust via Visibility" desc="Customers trust the process when they see a visual map of their delivery." />
                        </ul>
                        <div className="mt-6 pt-6 border-t border-slate-100">
                            <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">Coming Soon</h3>
                            <div className="flex flex-wrap gap-2">
                                <Badge text="Visual Search" />
                                <Badge text="Auto-Reversals" />
                                <Badge text="Instagram DM" />
                            </div>
                        </div>
                    </div>

                </div>
            );
        }

        // Component Helpers
        const LogicItem = ({ id, active, icon, label, color, bg }) => (
            <div className={`flex items-center gap-3 p-2 rounded-lg border transition-all ${active === id ? `border-green-400 ${bg}` : 'border-transparent opacity-60'}`}>
                <div className={`w-8 h-8 rounded-full flex items-center justify-center ${bg} ${color}`}><Icon name={icon} /></div>
                <span className={`text-xs font-bold ${active === id ? 'text-slate-800' : 'text-slate-500'}`}>{label}</span>
                {active === id && <span className="ml-auto w-2 h-2 bg-green-500 rounded-full animate-ping"></span>}
            </div>
        );

        const FeaturePoint = ({ icon, color, title, desc }) => (
            <li className="flex gap-3">
                <Icon name={icon} className={`text-xl shrink-0 ${color}`} />
                <div>
                    <h4 className="font-bold text-sm text-slate-800">{title}</h4>
                    <p className="text-xs text-slate-500 leading-relaxed">{desc}</p>
                </div>
            </li>
        );

        const Badge = ({ text }) => <span className="px-2 py-1 bg-slate-100 text-slate-500 text-[10px] font-bold rounded border border-slate-200">{text}</span>;

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
