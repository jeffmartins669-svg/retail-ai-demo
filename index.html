<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kwa Ntau ‚Äî Retail Automation Demo</title>

<!-- Tailwind for quick styling (demo only) -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Chart.js for dashboard charts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  :root{
    --primary-600:#F28F22; --primary-500:#F3A744; --primary-300:#F8C883;
    --steel-700:#525C66; --eco-700:#2F7D47;
    --bg:#f5f7fa;
  }
  body { background: var(--bg); font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
  /* small polished touches */
  .glass { backdrop-filter: blur(4px); background: rgba(255,255,255,0.6); }
  .kt-logo { display:flex; gap:.5rem; align-items:center; font-weight:700; font-size:1.05rem; color:var(--steel-700); }
  .kt-icon { width:36px;height:36px;border-radius:8px;background:linear-gradient(135deg,var(--primary-500),var(--primary-300)); display:flex;align-items:center;justify-content:center;color:white;font-weight:700; box-shadow:0 6px 20px rgba(34,34,34,0.12); }
  .pulse { animation: pulse 2s infinite; }
  @keyframes pulse { 0%{ transform:scale(1);} 50%{ transform:scale(1.03);} 100%{ transform:scale(1);} }
  .chip { background:#fff;padding:.25rem .5rem;border-radius:999px;border:1px solid #eee;font-size:.8rem; }
  .shadow-soft { box-shadow: 0 6px 18px rgba(16,24,40,0.06); }
  /* small responsive tweaks */
  @media (max-width:1024px){ .lg\\:show { display:none; } }
</style>
</head>
<body class="min-h-screen">

<!-- TOPBAR -->
<header class="flex items-center justify-between px-6 py-4 bg-white glass border-b">
  <div class="flex items-center gap-4">
    <div class="kt-logo">
      <div class="kt-icon">KN</div>
      <div>
        <div class="text-sm">Kwa Ntau</div>
        <div class="text-xs text-slate-500">Hardware ‚Ä¢ MaliMali Automation</div>
      </div>
    </div>
  </div>

  <div class="flex items-center gap-4">
    <div class="chip">Demo Mode</div>
    <button id="themeToggle" class="px-3 py-1 rounded shadow-soft text-sm">Toggle Theme</button>
    <a id="bookBtn" href="#" class="px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700 text-sm">Book a Call</a>
  </div>
</header>

<!-- MAIN -->
<main class="p-6 grid lg:grid-cols-3 gap-6 max-w-7xl mx-auto">

  <!-- LEFT: Interactive Product / Chat -->
  <section class="col-span-1 space-y-4">
    <!-- WhatsApp-style Chat Simulation -->
    <div class="bg-white rounded-2xl p-4 shadow-soft">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 rounded-lg bg-[#075E54] text-white flex items-center justify-center">ü§ñ</div>
        <div>
          <div class="font-semibold">Kwa Ntau Shop Bot</div>
          <div class="text-xs text-slate-500">Simulated WhatsApp conversation</div>
        </div>
        <div class="ml-auto text-xs text-slate-400">Live preview</div>
      </div>

      <div id="chatArea" class="mt-4 h-64 overflow-y-auto p-3 bg-slate-50 rounded-lg space-y-2" aria-live="polite">
        <!-- chat messages appear here -->
      </div>

      <div class="mt-3 flex gap-2">
        <input id="chatInput" class="flex-1 rounded-full p-3 border" placeholder="Type: e.g., 'Do you have cement?'" />
        <button id="sendBtn" class="px-4 rounded-full bg-[#075E54] text-white">Send</button>
        <button id="voiceBtn" class="px-3 rounded-full bg-orange-400 text-white">üéôÔ∏è</button>
      </div>

      <div class="mt-3 text-xs text-slate-500">Tip: Try phrases like <span class="font-medium">"stock", "price", "buy", "delivery"</span></div>
    </div>

    <!-- Product Browsing -->
    <div class="bg-white rounded-2xl p-4 shadow-soft">
      <div class="flex items-center justify-between mb-3">
        <div>
          <div class="font-semibold">Shop ‚Äî Hardware & MaliMali</div>
          <div class="text-xs text-slate-500">Click a product to view details & add to cart</div>
        </div>
        <div class="text-sm text-slate-500">Cart: <span id="cartCount">0</span></div>
      </div>

      <div id="productGrid" class="grid grid-cols-2 gap-3">
        <!-- product cards inserted here -->
      </div>

      <div class="mt-4 flex justify-between items-center">
        <button id="viewCart" class="px-3 py-2 bg-[#F28F22] text-white rounded">View Cart</button>
        <div class="text-xs text-slate-500">Demo payments simulated</div>
      </div>
    </div>

    <!-- Feedback & Feature Voting -->
    <div class="bg-white rounded-2xl p-4 shadow-soft">
      <div class="font-semibold mb-2">Collect Feedback</div>
      <div class="text-sm text-slate-500 mb-3">Ask clients to vote on features and leave comments.</div>

      <div class="grid grid-cols-1 gap-2 mb-3">
        <div class="flex items-center justify-between">
          <div>Auto stock alerts</div>
          <button class="voteBtn px-3 py-1 rounded bg-slate-100">Vote</button>
        </div>
        <div class="flex items-center justify-between">
          <div>WhatsApp ordering</div>
          <button class="voteBtn px-3 py-1 rounded bg-slate-100">Vote</button>
        </div>
        <div class="flex items-center justify-between">
          <div>Delivery tracking</div>
          <button class="voteBtn px-3 py-1 rounded bg-slate-100">Vote</button>
        </div>
      </div>

      <form id="feedbackForm" class="space-y-2">
        <input name="name" placeholder="Your name" class="w-full p-2 border rounded" />
        <input name="shop" placeholder="Shop name" class="w-full p-2 border rounded" />
        <textarea name="comment" placeholder="Comments or feature requests" rows="3" class="w-full p-2 border rounded"></textarea>
        <div class="flex gap-2">
          <button type="submit" class="px-3 py-2 rounded bg-green-600 text-white">Send Feedback</button>
          <button id="downloadPdf" type="button" class="px-3 py-2 rounded bg-slate-100">Download Brief</button>
        </div>
        <div id="feedbackStatus" class="text-xs text-green-600 mt-1"></div>
      </form>
    </div>
  </section>

  <!-- CENTER: Dashboard Preview (Clickable) -->
  <section class="col-span-1 lg:col-span-1 space-y-4">
    <div class="bg-white rounded-2xl p-4 shadow-soft">
      <div class="flex items-center justify-between">
        <div>
          <div class="text-sm font-semibold">Admin Dashboard</div>
          <div class="text-xs text-slate-500">Overview (click elements to interact)</div>
        </div>
        <div><span class="chip">Preview</span></div>
      </div>

      <div class="grid grid-cols-2 gap-3 mt-3">
        <div class="p-3 rounded-lg bg-slate-50">
          <div class="text-xs text-slate-500">Today Sales</div>
          <div class="text-xl font-bold">KES <span id="todaySales">14,500</span></div>
        </div>
        <div class="p-3 rounded-lg bg-slate-50">
          <div class="text-xs text-slate-500">Open Orders</div>
          <div class="text-xl font-bold"><span id="openOrders">3</span></div>
        </div>
      </div>

      <div class="mt-4 h-44">
        <canvas id="salesChart"></canvas>
      </div>

      <div class="mt-3">
        <div class="text-xs text-slate-500 mb-2">Recent Orders</div>
        <div id="ordersList" class="space-y-2">
          <!-- orders go here -->
        </div>
      </div>
    </div>

    <div class="bg-white rounded-2xl p-4 shadow-soft">
      <div class="flex items-center justify-between">
        <div class="text-sm font-semibold">Inventory</div>
        <div class="text-xs text-slate-500">Manage stock</div>
      </div>

      <div id="inventoryList" class="mt-3 space-y-2">
        <!-- inventory items -->
      </div>
    </div>
  </section>

  <!-- RIGHT: Details / Cart / Checkout -->
  <aside class="col-span-1 space-y-4 lg:col-span-1">
    <div id="panel" class="bg-white rounded-2xl p-4 shadow-soft min-h-[220px]">
      <div class="font-semibold">Cart & Checkout</div>
      <div id="cartView" class="mt-3 space-y-2 text-sm text-slate-600">
        <div>No items in cart</div>
      </div>
      <div class="mt-4 flex gap-2">
        <button id="checkoutBtn" class="px-3 py-2 bg-[#075E54] text-white rounded">Checkout</button>
        <button id="clearCart" class="px-3 py-2 bg-slate-100 rounded">Clear</button>
      </div>
    </div>

    <div class="bg-white rounded-2xl p-4 shadow-soft">
      <div class="font-semibold">Prototype Notes</div>
      <ul class="text-xs text-slate-500 mt-2 space-y-1">
        <li>‚Ä¢ Click products to add to cart. Try checkout to simulate M-Pesa STK.</li>
        <li>‚Ä¢ Vote + comment to capture customer needs. Votes persist locally (or submit to Google Sheets).</li>
        <li>‚Ä¢ Use "Mark delivered" in orders to simulate fulfillment and see inventory update.</li>
      </ul>
    </div>
  </aside>
</main>

<!-- Simple footer -->
<footer class="text-center text-xs text-slate-400 py-6">Kwa Ntau Demo ‚Ä¢ Built for client feedback ‚Ä¢ Share link with partners</footer>

<script>
/* -------------------------
  Configuration
----------------------------*/
const GOOGLE_SCRIPT_URL = ""; // optional: set your Google Apps Script URL to save feedback
const WHATSAPP_NUMBER = "https://wa.me/254XXXXXXXX"; // set your booking link
const CALENDLY_URL = ""; // optional

// sample product data
const products = [
  { id: 'p-cement', name: 'Cement (50kg)', price: 650, stock: 18, img: '' },
  { id: 'p-iron', name: 'Roofing Iron Sheet', price: 3200, stock: 6, img: '' },
  { id: 'p-nails', name: 'Box of Nails', price: 120, stock: 34, img: '' },
  { id: 'p-basin', name: 'Washing Basin', price: 900, stock: 4, img: '' }
];

// sample orders (admin view)
let orders = [
  { id: 'ord-1', customer: 'Asha ‚Ä¢ MaliMali', total: 3200, items: ['Roofing Iron Sheet'], status: 'pending' },
  { id: 'ord-2', customer: 'Juma ‚Ä¢ Shop', total: 770, items: ['Cement (50kg)', 'Nails'], status: 'pending' },
  { id: 'ord-3', customer: 'Mary ‚Ä¢ Contractor', total: 1200, items: ['Washing Basin'], status: 'delivered' }
];

let cart = [];

/* -------------------------
  Init: render products & dashboard
----------------------------*/
function renderProducts(){
  const grid = document.getElementById('productGrid');
  grid.innerHTML = '';
  products.forEach(p=>{
    const el = document.createElement('div');
    el.className = 'p-3 bg-white rounded-lg border shadow-sm cursor-pointer';
    el.innerHTML = `
      <div class="font-semibold">${p.name}</div>
      <div class="text-xs text-slate-500">KES ${p.price.toLocaleString()}</div>
      <div class="text-xs mt-2 ${p.stock<5 ? 'text-red-600' : 'text-slate-500'}">Stock: ${p.stock}</div>
    `;
    el.onclick = ()=> addToCart(p.id);
    grid.appendChild(el);
  });
  updateCartCount();
}

function renderOrders(){
  const list = document.getElementById('ordersList');
  list.innerHTML = '';
  orders.slice().reverse().forEach(o=>{
    const div = document.createElement('div');
    div.className = 'p-2 rounded-lg bg-slate-50 flex items-center justify-between';
    div.innerHTML = `<div class="text-sm"><div class="font-medium">${o.customer}</div><div class="text-xs text-slate-500">${o.items.join(', ')}</div></div>
      <div class="text-right">
        <div class="font-semibold">KES ${o.total}</div>
        <div class="text-xs mt-1">${o.status}</div>
        <div class="mt-2 flex gap-2">
          ${o.status !== 'delivered' ? `<button class="markBtn px-2 py-1 text-xs bg-green-600 text-white rounded" data-id="${o.id}">Mark delivered</button>` : ''}
          <button class="viewBtn px-2 py-1 text-xs bg-slate-100 rounded" data-id="${o.id}">View</button>
        </div>
      </div>`;
    list.appendChild(div);
  });
  // attach handlers
  document.querySelectorAll('.markBtn').forEach(b=>{
    b.onclick = (e) => { const id = e.target.dataset.id; markDelivered(id); };
  });
}

function renderInventory(){
  const container = document.getElementById('inventoryList');
  container.innerHTML = '';
  products.forEach(p=>{
    const div = document.createElement('div');
    div.className = 'p-2 rounded-lg bg-slate-50 flex items-center justify-between';
    div.innerHTML = `<div class="${p.stock<5 ? 'text-red-600 font-semibold' : ''}">${p.name}</div>
      <div class="text-xs">
        <div>Stock: ${p.stock}</div>
        <div class="mt-1"><button data-id="${p.id}" class="restockBtn px-2 py-1 bg-slate-100 rounded text-xs">+ Restock</button></div>
      </div>`;
    container.appendChild(div);
  });
  document.querySelectorAll('.restockBtn').forEach(b=>{
    b.onclick = (e)=> { const id = e.target.dataset.id; restockItem(id); };
  });
}

/* -------------------------
  Cart logic
----------------------------*/
function addToCart(id){
  const p = products.find(x=>x.id===id);
  if(!p || p.stock<=0){ alert('Out of stock'); return; }
  const existing = cart.find(c=>c.id===id);
  if(existing) existing.qty++;
  else cart.push({ id:p.id, name:p.name, price:p.price, qty:1 });
  updateCartView();
  updateCartCount();
}
function updateCartView(){
  const view = document.getElementById('cartView');
  view.innerHTML = '';
  if(cart.length===0){ view.innerHTML = '<div>No items in cart</div>'; return; }
  let total=0;
  cart.forEach(i=>{
    total += i.price*i.qty;
    const row = document.createElement('div');
    row.className = 'flex items-center justify-between';
    row.innerHTML = `<div>${i.name} <span class="text-xs text-slate-500">x${i.qty}</span></div><div>KES ${ (i.price*i.qty).toLocaleString() }</div>`;
    view.appendChild(row);
  });
  const totdiv = document.createElement('div');
  totdiv.className = 'mt-3 flex items-center justify-between font-semibold';
  totdiv.innerHTML = `<div>Total</div><div>KES ${total.toLocaleString()}</div>`;
  view.appendChild(totdiv);
}
function updateCartCount(){ document.getElementById('cartCount').textContent = cart.reduce((s,i)=>s+i.qty,0); }

/* -------------------------
  Orders & inventory actions
----------------------------*/
function markDelivered(id){
  orders = orders.map(o=> o.id===id ? {...o, status:'delivered'} : o );
  // reduce stock for that order (simulate)
  const ord = orders.find(o=>o.id===id);
  if(ord){
    ord.items.forEach(name=>{
      const prod = products.find(p=>p.name===name);
      if(prod) prod.stock = Math.max(0, prod.stock - 1);
    });
  }
  renderOrders(); renderInventory(); renderProducts(); updateCounts();
}

function restockItem(id){
  const prod = products.find(p=>p.id===id);
  if(prod){ prod.stock += 10; renderInventory(); renderProducts(); }
}

/* -------------------------
  Feedback & votes (local or send)
----------------------------*/
function voteFeature(name, button){
  const votes = JSON.parse(localStorage.getItem('kt_votes')||'{}');
  votes[name] = (votes[name]||0) + 1;
  localStorage.setItem('kt_votes', JSON.stringify(votes));
  button.textContent = 'Voted ‚úì';
  button.disabled = true;
}

async function submitFeedback(form){
  const data = { name: form.name.value||'Anonymous', shop: form.shop.value||'-', comment: form.comment.value };
  if(GOOGLE_SCRIPT_URL){
    const fd = new FormData();
    fd.append('name', data.name); fd.append('shop', data.shop); fd.append('comment', data.comment);
    try{
      await fetch(GOOGLE_SCRIPT_URL, { method:'POST', body:fd });
      document.getElementById('feedbackStatus').textContent = 'Thanks ‚Äî feedback sent.';
    }catch(err){
      document.getElementById('feedbackStatus').textContent = 'Error sending; saved locally.';
      saveFeedbackLocal(data);
    }
  } else {
    saveFeedbackLocal(data);
    document.getElementById('feedbackStatus').textContent = 'Feedback saved locally (no backend configured).';
  }
  form.reset();
  setTimeout(()=>document.getElementById('feedbackStatus').textContent = '',4000);
}
function saveFeedbackLocal(data){
  const arr = JSON.parse(localStorage.getItem('kt_feedback')||'[]');
  arr.push({...data, ts:new Date().toISOString()});
  localStorage.setItem('kt_feedback', JSON.stringify(arr));
}

/* -------------------------
  Chat bot simulation
----------------------------*/
function appendChat(text, who='bot'){
  const area = document.getElementById('chatArea');
  const div = document.createElement('div');
  div.className = `p-3 rounded-lg ${who==='bot' ? 'bg-white text-slate-800' : 'bg-emerald-100 text-slate-800 ml-auto'}`;
  div.style.maxWidth = '80%';
  div.textContent = text;
  area.appendChild(div);
  area.scrollTop = area.scrollHeight;
}
function processChatInput(txt){
  appendChat(txt,'user');
  setTimeout(()=>{
    const t = txt.toLowerCase();
    if(t.includes('stock') || t.includes('do you have')) {
      // find first matching product
      const found = products.find(p=> t.includes(p.name.split(' ')[0].toLowerCase()) || p.name.toLowerCase().includes(t.replace('do you have ','').trim()));
      if(found) appendChat(`Yes ‚Äî ${found.name} ‚Ä¢ Price: KES ${found.price} ‚Ä¢ Stock: ${found.stock}`);
      else appendChat('I can check stock and reserve items. What product are you looking for?');
    } else if(t.includes('price')) {
      appendChat('Tell me which product (e.g., "price of cement") and I will respond.');
    } else if(t.includes('buy') || t.includes('order')) {
      appendChat('Great ‚Äî I can reserve this and send a payment request. Would you like to add to cart? (Try "add cement")');
    } else if(t.startsWith('add ')) {
      const q = t.replace('add ','');
      const prod = products.find(p=>p.name.toLowerCase().includes(q));
      if(prod){ addToCart(prod.id); appendChat(`${prod.name} added to cart.`); }
      else appendChat(`Couldn't find "${q}". Try a product name.`);
    } else {
      appendChat("Demo: I'm a simulation. Try 'stock', 'price', 'buy', or 'add cement'.");
    }
  }, 600);
}

/* -------------------------
  Checkout simulation
----------------------------*/
function checkout(){
  if(cart.length===0){ alert('Cart empty'); return; }
  // create a fake order
  const total = cart.reduce((s,i)=>s+i.price*i.qty,0);
  const id = 'ord-' + Math.random().toString(36).slice(2,7);
  const newOrder = { id, customer: 'Demo Customer', total, items: cart.map(i=>i.name), status:'pending' };
  orders.push(newOrder);
  // reduce stock immediately for demo
  cart.forEach(it=>{
    const p = products.find(x=>x.id===it.id);
    if(p) p.stock = Math.max(0,p.stock - it.qty);
  });
  cart = [];
  updateCartView(); updateCartCount();
  renderOrders(); renderInventory(); renderProducts(); updateCounts();
  appendChat('Payment request sent (simulated). Order created: ' + id);
  // show a fake MPESA modal (simple)
  showMpesaPrompt(total, id);
}

function showMpesaPrompt(amount, orderId){
  const yes = confirm(`Simulate M-Pesa payment of KES ${amount.toLocaleString()} for ${orderId}?\nClick OK to simulate successful payment.`);
  if(yes){
    // mark order paid -> delivered for demo
    orders = orders.map(o=> o.id===orderId ? {...o, status:'delivered'} : o);
    renderOrders();
    appendChat('‚úÖ Payment received. Order marked delivered.');
  } else {
    appendChat('Payment cancelled (demo).');
  }
}

/* -------------------------
  Charts & counts
----------------------------*/
function initSalesChart(){
  const ctx = document.getElementById('salesChart');
  new Chart(ctx, {
    type:'line',
    data:{
      labels:['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],
      datasets:[{ label:'KES Sales', data:[12000,9000,15000,11000,14500,17000,13500], fill:true, tension:0.3, backgroundColor:'rgba(242,143,34,0.12)', borderColor:'rgba(242,143,34,0.95)' }]
    },
    options:{ plugins:{legend:{display:false}}, scales:{ y:{ ticks:{ callback: v => 'KES '+v } } } }
  });
}

function updateCounts(){
  document.getElementById('todaySales').textContent = 14500;
  document.getElementById('openOrders').textContent = orders.filter(o=>o.status!=='delivered').length;
}

/* -------------------------
  UI wiring
----------------------------*/
document.getElementById('sendBtn').onclick = ()=> {
  const v = document.getElementById('chatInput').value.trim(); if(!v) return;
  processChatInput(v); document.getElementById('chatInput').value='';
};
document.getElementById('voiceBtn').onclick = ()=> {
  appendChat('üéôÔ∏è Voice note: "Add cement please"', 'user');
  setTimeout(()=> processChatInput('add cement'), 700);
};

document.getElementById('viewCart').onclick = ()=> {
  // focus cart panel (scroll)
  document.getElementById('panel').scrollIntoView({behavior:'smooth'});
};

document.getElementById('checkoutBtn').onclick = ()=> checkout();
document.getElementById('clearCart').onclick = ()=> { cart=[]; updateCartView(); updateCartCount(); };

document.querySelectorAll('.voteBtn').forEach((b,i)=>{
  b.onclick = ()=> voteFeature(['Auto stock alerts','WhatsApp ordering','Delivery tracking'][i], b);
});

document.getElementById('feedbackForm').onsubmit = (e)=> { e.preventDefault(); submitFeedback(e.target); };

document.getElementById('downloadPdf').onclick = ()=>{
  // produce a short PDF-like print (simple)
  const specs = `Kwa Ntau ‚Ä¢ Retail Automation Brief\n\nProblems solved:\n- Automate WhatsApp orders\n- Low-stock alerts\n- M-Pesa integration\n\nNext steps: Discovery -> MVP -> Pilot\n`;
  const w = window.open('','print');
  w.document.write('<pre>'+specs+'</pre>'); w.print();
};

document.getElementById('bookBtn').onclick = (e)=> {
  e.preventDefault();
  if (CALENDLY_URL) window.open(CALENDLY_URL, '_blank');
  else window.open(WHATSAPP_NUMBER, '_blank');
};

/* Theme toggle (light / dark demo) */
let dark=false;
document.getElementById('themeToggle').onclick = ()=>{
  dark = !dark;
  if(dark) document.documentElement.style.background='#0b1220', document.body.style.background='#071023', document.querySelectorAll('main,header,footer').forEach(n=> n.classList.add('text-white'));
  else { document.documentElement.style.background=''; document.body.style.background=''; document.querySelectorAll('main,header,footer').forEach(n=> n.classList.remove('text-white')); }
};

/* initial render */
renderProducts(); renderOrders(); renderInventory(); updateCartView(); initSalesChart(); updateCounts();

/* Quick demo content */
appendChat("Karibu! üëã I'm the Kwa Ntau shop bot. Try 'stock' or 'add cement'.");
</script>
</body>
</html>
